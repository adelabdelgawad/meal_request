# ==============================================================================
# Backend Application Configuration - TEMPLATE
# ==============================================================================
# Copy this file to .env.backend and update with your values
# ==============================================================================

# ==============================================================================
# Environment
# ==============================================================================
ENVIRONMENT=development  # Options: local, development, production
LOG_LEVEL=INFO          # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
PYTHONPATH=/app

# Logging Configuration
ENABLE_JSON_LOGS=false  # Set to true for JSON logs in production

# ==============================================================================
# Default Admin Account (created on startup)
# ==============================================================================
APP_USERNAME=admin
APP_PASSWORD=CHANGE_ME_IN_PRODUCTION

# ==============================================================================
# Database Configuration (MariaDB/MySQL)
# ==============================================================================
DB_SERVER=database      # Use 'localhost' for local dev, 'database' for Docker
DB_PORT=3306
DB_USER=meal_user
DB_PASSWORD=CHANGE_ME_IN_PRODUCTION
DB_NAME=meal_request_db

# Full connection URL (auto-constructed from above values)
MARIA_URL=mysql+aiomysql://meal_user:CHANGE_ME_IN_PRODUCTION@database:3306/meal_request_db?charset=utf8mb4

# ==============================================================================
# External Databases (read-only connections)
# ==============================================================================
# HRIS (Human Resources Information System) database
# Note: Special characters in password must be URL-encoded:
#   @ = %40, % = %25, ! = %21, $ = %24, # = %23, & = %26
HRIS_URL=mssql+pyodbc://username:password@host/database?driver=ODBC+Driver+17+for+SQL+Server

# ==============================================================================
# Redis Configuration
# ==============================================================================
REDIS_URL=redis://redis:6379/0  # Use redis://localhost:6379/0 for local dev
REDIS_ENABLED=true
REDIS_MAX_CONNECTIONS=20

# ==============================================================================
# Celery Configuration
# ==============================================================================
CELERY_ENABLED=true
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# ==============================================================================
# JWT Authentication & Session Management
# ==============================================================================
# IMPORTANT: Generate a strong random secret key for production!
# You can generate one with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=CHANGE_ME_USE_OPENSSL_RAND_HEX_32
JWT_ALGORITHM=HS256

# Token Lifetimes - BALANCED SECURITY
# - Access tokens are short-lived (used for API requests)
# - Session/refresh tokens are long-lived (stored in HttpOnly cookies)
SESSION_ACCESS_TOKEN_MINUTES=15
SESSION_REFRESH_LIFETIME_DAYS=30

# Legacy token lifetime settings (for backwards compatibility)
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=30

# Session Cookie Security
SESSION_COOKIE_SECURE=false  # Set to true for production with HTTPS
SESSION_COOKIE_SAMESITE=lax  # Options: lax, strict, none

# ==============================================================================
# LDAP/Active Directory Configuration
# ==============================================================================
# Configure for LDAP authentication
AD_DOMAIN=yourdomain.loc
AD_SERVER=your-domain-controller.yourdomain.loc
SERVICE_ACCOUNT=service_account_username
SERVICE_PASSWORD=service_account_password

# AD User Sync Configuration
# Comma-separated list of OUs to fetch users from (e.g., CAR,SMH,ASH)
# Leave empty to fetch from entire domain OU (not recommended)
AD_ALLOWED_OUS=[OU1,OU2,OU3]

# ==============================================================================
# Email / Exchange Web Services (EWS)
# ==============================================================================
DOMAIN_USER="DOMAIN\\ServiceAccount"
PASSWORD="ServiceAccountPassword"
PRIMARY_SMTP_ADDRESS="serviceaccount@yourdomain.net"
SMTP_SERVER="mail.yourdomain.net"
CC_RECIPIENT="admin@yourdomain.net"

# ==============================================================================
# CORS Configuration
# ==============================================================================
# Use indexed format for Pydantic Settings to parse as a list
# Add your frontend URLs here
ALLOWED_ORIGINS__0=http://localhost:3000
ALLOWED_ORIGINS__1=http://localhost:8080
ALLOWED_ORIGINS__2=http://nginx
ALLOWED_ORIGINS__3=http://frontend:3000

# ==============================================================================
# Security & Rate Limiting
# ==============================================================================
RATE_LIMIT_ENABLED=true

# ==============================================================================
# Observability & Monitoring
# ==============================================================================
# Prometheus metrics are always available at /metrics when prometheus_client is installed
# Configure OpenTelemetry for distributed tracing (optional)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317
