# Application Environment
# Options: local, development, production
ENVIRONMENT=local

# Default admin account (created on startup)
# Password requirements: 8+ chars, uppercase, lowercase, digit, special character
# Password will be automatically hashed with bcrypt before storage
APP_USERNAME=admin
APP_PASSWORD=Admin123!  # CHANGE THIS in production!

# =============================================================================
# PRIMARY DATABASE (MariaDB)
# =============================================================================
# Option 1: Full connection URL (recommended)
MARIA_URL=mysql+aiomysql://meal_user:meal_password@localhost:3306/meal_request_db?charset=utf8mb4

# Option 2: Individual variables (used if MARIA_URL is not set)
DB_USER=meal_user
DB_PASSWORD=meal_password
DB_SERVER=localhost
DB_NAME=meal_request_db

# =============================================================================
# EXTERNAL DATABASES (read-only connections)
# =============================================================================
# Note: Special characters in password must be URL-encoded:
#   @ = %40, % = %25, ! = %21, $ = %24, # = %23, & = %26

# HRIS (Human Resources Information System) database
HRIS_URL=mssql+pyodbc://user:pass@server/hris?driver=ODBC+Driver+17+for+SQL+Server

# =============================================================================
# JWT AUTHENTICATION & SESSION MANAGEMENT
# =============================================================================
# IMPORTANT: Use a strong, unique secret key in production (min 32 characters)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=your-secure-random-secret-key-here-min-32-chars
JWT_ALGORITHM=HS256

# Session/Token Configuration
SESSION_ACCESS_TOKEN_MINUTES=15
SESSION_REFRESH_LIFETIME_DAYS=30
SESSION_MAX_CONCURRENT=5

# Session Cookie Configuration
SESSION_COOKIE_NAME=refresh
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_SAMESITE=strict

# =============================================================================
# LDAP / ACTIVE DIRECTORY
# =============================================================================
AD_SERVER=ldap://your-domain.com
AD_DOMAIN=your-domain
SERVICE_ACCOUNT=service_account
SERVICE_PASSWORD=service_password

# AD User Sync Configuration
# Comma-separated list of OUs to fetch users from (e.g., CAR,SMH,ASH)
# Leave empty to fetch from entire Andalusia OU (not recommended)
AD_ALLOWED_OUS=CAR,SMH,ASH
# Base DN for AD searches
AD_BASE_DN=DC=andalusia,DC=loc
# OU path template - {ou} will be replaced with each allowed OU
AD_OU_PATH_TEMPLATE=OU=Users,OU={ou},OU=Andalusia

# =============================================================================
# CORS (Cross-Origin Resource Sharing)
# =============================================================================
# Use indexed format for Pydantic Settings to parse as a list
ALLOWED_ORIGINS__0=http://localhost:3000
ALLOWED_ORIGINS__1=http://localhost:8080

# =============================================================================
# EMAIL / EXCHANGE WEB SERVICES (EWS)
# =============================================================================
PRIMARY_SMTP_ADDRESS=noreply@example.com
SMTP_SERVER=mail.example.com
CC_RECIPIENT=admin@example.com

# =============================================================================
# LOGGING
# =============================================================================
LOG_LEVEL=INFO
# Set to false for human-readable logs in development, true for JSON in production
ENABLE_JSON_LOGS=false
# Optional: Specify a log file path
# LOG_FILE=/var/log/meal_request/app.log

# =============================================================================
# LOCALE & INTERNATIONALIZATION
# =============================================================================
# Default application locale (en or ar)
DEFAULT_LOCALE=en
# Supported locales (comma-separated)
SUPPORTED_LOCALES=en,ar
# Locale preference cookie configuration
LOCALE_COOKIE_NAME=locale
LOCALE_COOKIE_SECURE=false
LOCALE_COOKIE_SAMESITE=lax
LOCALE_COOKIE_MAX_AGE_DAYS=365

# =============================================================================
# OBSERVABILITY & METRICS
# =============================================================================
# Prometheus metrics are always enabled at /metrics endpoint

# OpenTelemetry Configuration (optional)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
# OTEL_EXPORTER_OTLP_HEADERS=Authorization=Bearer+token

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
# Redis URL for caching, rate limiting, session storage, and Celery broker
# Format: redis://[username:password@]host:port/db
# Examples:
#   redis://localhost:6379/0                    # Local Redis
#   redis://user:pass@redis:6379/0             # Redis with auth
#   redis://redis-cluster:6379/0               # Redis cluster
REDIS_URL=redis://localhost:6379/0

# Redis Password (optional, for production)
# REDIS_PASSWORD=your-secure-redis-password

# Redis Host and Port (alternative to REDIS_URL)
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_DB=0

# Redis Connection Pool Settings
REDIS_MAX_CONNECTIONS=20

# Redis Connection Timeouts (seconds)
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5

# Redis Health Check Interval (seconds)
REDIS_HEALTH_CHECK_INTERVAL=30

# Redis Retry Configuration
REDIS_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY=1.0

# =============================================================================
# REDIS FEATURE FLAGS
# =============================================================================
# Enable/disable Redis features
REDIS_ENABLED=true
CELERY_ENABLED=true

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true
RATE_LIMIT_LOGIN=10/minute
RATE_LIMIT_DEFAULT=100/minute
RATE_LIMIT_STRICT=20/minute

# =============================================================================
# REDIS CACHE TTL SETTINGS (seconds)
# =============================================================================
# Token revocation cache TTL (should match access token lifetime)
REDIS_REVOKED_TOKEN_TTL_SECONDS=900

# Session state cache TTL
REDIS_SESSION_CACHE_TTL_SECONDS=300

# User permissions cache TTL
REDIS_PERMISSION_CACHE_TTL_SECONDS=600

# General application cache TTL
REDIS_CACHE_TTL_SECONDS=1800

# =============================================================================
# REDIS SECURITY SETTINGS
# =============================================================================
# Circuit Breaker Configuration (for Redis operations)
REDIS_CIRCUIT_BREAKER_ENABLED=true
REDIS_CIRCUIT_BREAKER_THRESHOLD=5
REDIS_CIRCUIT_BREAKER_TIMEOUT=30

# Redis Monitoring and Alerting
REDIS_MONITORING_ENABLED=true
REDIS_LATENCY_THRESHOLD_MS=100
REDIS_MEMORY_THRESHOLD_PERCENT=80

# =============================================================================
# MESSAGE QUEUE CONFIGURATION
# =============================================================================
# Redis-based message queue settings
MQ_ENABLED=true
MQ_DEFAULT_TIMEOUT=30
MQ_MAX_QUEUE_LENGTH=10000

# Message queue names
MQ_EMAIL_QUEUE=email_queue
MQ_NOTIFICATION_QUEUE=notification_queue
MQ_REPORT_QUEUE=report_queue
